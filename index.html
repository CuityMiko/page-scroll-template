<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no">
  <title>Document</title>
</head>
<body>

<style>
body {
  margin: 0;
}
.page {
  height: 800px;
}
.page1 {
  background-color: #aec7e8;
}
.page2 {
  background-color: #98df8a;
}
.page3 {
  background-color: #c5b0d5;
}
.page4 {
  background-color: #c7c7c7;
}

</style>

<div class="page page1">1</div>
<div class="page page2">2</div>
<div class="page page3">3</div>
<div class="page page4">4</div>

<script src="//g.tbcdn.cn/mm/activity-assets/20150909.162311.437/jquery-1.11.3.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150813.183131.653/underscore.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150906.094858.101/TweenLite.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150906.094858.101/ScrollToPlugin.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150901.123422.836/jquery.mousewheel.min.js"></script>

<script>
(function () {

  // 每一屏的控制逻辑
  var page1 = {
    show: function () {
    },
    hide: function () {
    }
  };
  var page2 = {
  show: function () {
  },
  hide: function () {
  }
  };

  var pageCtrl = {
    pages: $('.page'),
    current: 0,
    steps: [0, 800, 1600, 2400],  // 每一屏对应的滚动位置, 长度应该等于pages.length
    duration: 0.3,

    // 没一屏显示或者隐藏时, 调用对应的回调, 如果不需要, 设置为空函数
    show: [page1.show, page2.show, $.noop, $.noop],
    hide: [page1.hide, page2.hide, $.noop, $.noop]
  };

  pageCtrl.init = function () {
    pageCtrl.addListeners();
    pageCtrl.adjustPageHeight();
    pageCtrl.go(0);
  };

  pageCtrl.addListeners = function () {
    var win = $(window);

    // 键盘上下键,切换键盘
    win.on('keydown.page', function (e) {
      switch (e.which) {
        case 38:
          e.preventDefault();
          pageCtrl.up();
          break;
        case 40:
          e.preventDefault();
          pageCtrl.down();
          break;
      }
    });

    // 鼠标滚动, 切换屏幕
    win.on('mousewheel', function (e) {
      e.preventDefault();
    });
    win.on('mousewheel',  _.throttle(function (e) {
      if (e.deltaY > 0) {
        pageCtrl.up();
      } else if (e.deltaY < 0) {
        pageCtrl.down();
      }
    }, 1200, {trailing: false}));

    // 窗口大小改变, 每一屏大小也改变
    win.on('resize', _.debounce(pageCtrl.adjustPageHeight, 400));
  };

  pageCtrl.adjustPageHeight = function () {
    var height = $(window).height();
    pageCtrl.pages.height(height);
    var steps = [];
    for (var i = 0; i < pageCtrl.pages.length; ++i) {
      steps.push(i * height);
    }
    pageCtrl.steps = steps;
  };

  pageCtrl.go = function (index, prev) {
    var me = this;
    if (index < 0) {
      index = 0;
      prev = null;
    } else if (index >= me.pages.length) {
      index = me.pages.length - 1;
      prev = null;
    }

    me.current = index;
    TweenLite.to(window, me.duration, {
      scrollTo: {y: me.steps[index]},
      onComplete: function () {
        me.show[index]();
        if (prev != null) {
          me.hide[prev]();
        }
      }
    });
  };
  pageCtrl.up = function () {
    this.go(this.current - 1, this.current);
  };
  pageCtrl.down = function () {
    this.go(this.current + 1, this.current);
  };


  pageCtrl.init();

}());
</script>

</body>
</html>
