<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=no">
  <title>Document</title>
</head>
<body>

<style>
body {
  margin: 0;
}
.page {
  height: 800px;
}
.page1 {
  background-color: #aec7e8;
}
.page2 {
  background-color: #98df8a;
}
.page3 {
  background-color: #c5b0d5;
}
.page4 {
  background-color: #c7c7c7;
}


.page-nav {
  list-style: none;
  margin: 0;
  padding: 0;
  position: fixed;
  top: 330px;
  right: 60px;
}
.page-nav a {
  display: block;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: #414956;
  margin: 0 0 22px 0;
}
.page-nav .active a {
  background-color: #09f;
}
</style>

<!-- 每一屏都需要标记page类 -->
<div class="page page1">1</div>
<div class="page page2">2</div>
<div class="page page3">3</div>
<div class="page page4">4</div>

<!-- 右侧导航, 如果不需要, 用css隐藏掉, data-target表示目标页, 下标从0开始 -->
<ul class="page-nav">
  <li data-target="0" class="active"><a href="javascript:;"></a></li>
  <li data-target="1"><a href="javascript:;"></a></li>
  <li data-target="2"><a href="javascript:;"></a></li>
  <li data-target="3"><a href="javascript:;"></a></li>
</ul>

<script src="//g.tbcdn.cn/mm/activity-assets/20150909.162311.437/jquery-1.11.3.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150813.183131.653/underscore.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150906.094858.101/TweenLite.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150906.094858.101/ScrollToPlugin.min.js"></script>
<script src="//g.tbcdn.cn/mm/activity-assets/20150901.123422.836/jquery.mousewheel.min.js"></script>

<script>
(function () {

  // 每一屏的控制逻辑
  var page1 = {
    show: function () {
    },
    hide: function () {
    }
  };
  var page2 = {
  show: function () {
  },
  hide: function () {
  }
  };

  var pageCtrl = {
    current: 0,
    pages: $('.page'),
    nav: $('.page-nav'),
    steps: [0, 800, 1600, 2400],  // 每一屏对应的滚动位置, 长度应该等于pages.length
    duration: 0.3,

    // 没一屏显示或者隐藏时, 调用对应的回调, 如果不需要, 设置为空函数
    show: [page1.show, page2.show, $.noop, $.noop],
    hide: [page1.hide, page2.hide, $.noop, $.noop]
  };

  /**
   * 初始化
   * @param opt {Object} 参数
   *  opt.pageSelector {string} 选择所有页面的选择器, 如.page
   *  opt.showNav {boolean} 是否显示右侧导航
   **/
  pageCtrl.init = function (opt) {
    pageCtrl.addListeners();
    pageCtrl.adjustPageHeight();
    pageCtrl.go(0);
  };


  pageCtrl.addListeners = function () {
    var doc = $(document);

    // 键盘上下键,切换键盘
    doc.on('keydown', function (e) {
      switch (e.which) {
        case 38:
          e.preventDefault();
          pageCtrl.up();
          break;
        case 40:
          e.preventDefault();
          pageCtrl.down();
          break;
      }
    });

    // 鼠标滚动, 切换屏幕

    doc.on('mousewheel', false);
    doc.on('mousewheel',  _.throttle(function (e) {
      if (e.deltaY > 0) {
        pageCtrl.up();
      } else if (e.deltaY < 0) {
        pageCtrl.down();
      }
    }, 1200, {trailing: false}));

    // 监听右侧导航
    pageCtrl.nav.on('click', 'li', function (e) {
      var item = $(this);
      var targetPage = parseInt(item.data('target'), 10);
      pageCtrl.go(targetPage, pageCtrl.current);
    });

    // 窗口大小改变, 每一屏大小也改变
    $(window).on('resize', _.debounce(pageCtrl.adjustPageHeight, 400));
  };

  pageCtrl.adjustPageHeight = function () {
    var height = $(window).height();
    pageCtrl.pages.height(height);
    var steps = [];
    for (var i = 0; i < pageCtrl.pages.length; ++i) {
      steps.push(i * height);
    }
    pageCtrl.steps = steps;
    window.scrollTo(0, steps[pageCtrl.current]);
  };

  pageCtrl.go = function (index, prev) {
    var me = this;
    if (index < 0) {
      index = 0;
      prev = null;
    } else if (index >= me.pages.length) {
      index = me.pages.length - 1;
      prev = null;
    }

    me.current = index;
    me.nav.find('li')
      .removeClass('active')
      .filter(':nth-child(' + (index + 1) + ')')
      .addClass('active');
    TweenLite.to(window, me.duration, {
      scrollTo: {y: me.steps[index]},
      onComplete: function () {
        me.show[index]();
        if (prev != null) {
          me.hide[prev]();
        }
      }
    });
  };
  pageCtrl.up = function () {
    this.go(this.current - 1, this.current);
  };
  pageCtrl.down = function () {
    this.go(this.current + 1, this.current);
  };


  pageCtrl.init({
    pageSelector: '.page'
  });

}());
</script>

</body>
</html>
